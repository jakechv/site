<!DOCTYPE html><html><head><meta charset="UTF-8" /><title>lastfm / lastfm / components / Jake Chvatal</title><meta content="width=device-width,initial-scale=1.0" name="viewport" /><meta content="lastfm" property="og:title" /><meta content="website" property="og:type" /><meta content="https://jake.isnt.online" property="og:url" /><meta content="Jake Chvatal" property="og:site_name" /><meta content="hi" name="description" /><meta content="Operating Systems, webring, programming, languages" name="keywords" /><meta content="Jake Chvatal" name="author" /><meta content="index,follow" name="robots" /><meta content="white" media="(prefers-color-scheme: light)" name="theme-color" /><meta content="#111" media="(prefers-color-scheme: dark)" name="theme-color" /><link href="/favicon/apple-touch-icon.png" rel="apple-touch-icon" /><link href="/manifest.json" rel="manifest" /><link href="/resources/style.css" id="/resources/style.css" rel="stylesheet" type="text/css" /><link href="/resources/global.css" id="/resources/global.css" rel="stylesheet" type="text/css" /><script id="/resources/lib.js" src="/resources/lib.js"></script><link href="/resources/elements.css" id="/resources/elements.css" rel="stylesheet" type="text/css" /><script defer="defer" id="/resources/elements.js" src="/resources/elements.js"></script><script defer="defer" id="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/highlight.min.js" src="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/highlight.min.js"></script><script defer="defer" id="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/languages/clojure.min.js" src="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/languages/clojure.min.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/nord.min.css" id="dark-theme-highlight" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-light.min.css" id="light-theme-highlight" rel="stylesheet" /></head><body><span><div class="sidebar"><div class="url-path"><a href="/">jake.</a><a href="https://isnt.online"> ~ </a><span> / </span><a href="./index.html">components</a><span> / </span><a href="./index.html">lastfm</a><span> / </span><b>lastfm</b></div><span><div class="toggle-dark-mode-container"><button class="toggle-dark-mode"></button></div><script defer="defer" id="/components/toggle-dark-mode/toggle-dark-mode.js" src="/components/toggle-dark-mode/toggle-dark-mode.js"></script><link href="/components/toggle-dark-mode/toggle-dark-mode.css" id="/components/toggle-dark-mode/toggle-dark-mode.css" rel="stylesheet" type="text/css" /></span></div><link href="/components/sidebar/sidebar.css" id="/components/sidebar/sidebar.css" rel="stylesheet" type="text/css" /></span><div class="site-body"><main><article class="wikipage"><h1 class="title-top">lastfm</h1><pre><code class="language-js has-raw-code /components/lastfm/lastfm.js">/* OLD SCHOOL CURRENT PLAYING STUFF */
/* source: https://gist.github.com/trisweb/2c0c94273f653c81f34dbe8e85ad30e7 via https://www.trisweb.com/ */
/*
  /other cool idea: changing color and contrast of tbe website background when pressing a key, tapping or clicking
*/

var LFM_API = "https://ws.audioscrobbler.com/2.0/";
var LFM_KEY = "14eb0c0c914456103f2c584d930a44ba"; // Get one at https://secure.last.fm/login?next=/api/account/create
var LFM_USER = "jakeisnt";
var recentTracksUrl =
    LFM_API+"?method=user.getrecenttracks&user="+LFM_USER+"&api_key="+LFM_KEY+"+&format=json&limit=1";

const LFM_TIMEOUT = 1000 * 60; // 1 minute

const lastfm = () => {
  var nowPlayingNode = null;

  function getNowPlaying() {
    get(recentTracksUrl, (response) => {
      var currentTrack = response.recenttracks.track[0];

      // Check if it's the same, if not then rerender
      if (!window.nowPlaying || window.nowPlaying.mbid != currentTrack.mbid) {
        window.nowPlaying = currentTrack;
        renderNowPlaying(currentTrack);
      }
      setTimeout(getNowPlaying, LFM_TIMEOUT);
    });
  }

  function getMetadata(track) {
    return create2("table", { className: 'metadata-table'},
      create2("tr", {},
              create2("th", {}, "Artist"),
              create2("td", {}, track.artist["#text"])),
      create2("tr", {},
              create2("th", {}, "Title"),
              create2("td", {}, track.name)),
      create2("tr", {},
              create2("th", {}, "Listened"),
              create2("td", {}, track.date["#text"])));
  }

  function renderNowPlaying(track) {
    console.log(track);
    if (nowPlayingNode) {
      nowPlayingNode.remove();
    }

    nowPlayingNode = create('div', {
      className: 'now-playing',
      href: track.url,
      target: 'blank',
    }, $(".lastfm-now-playing-box"));

    const nowPlayingImage = create('img', {
      className: 'np-image',
      width: '128',
      height: '128',
      src: track.image.slice(-1)[0]["#text"],
    }, nowPlayingNode);

    const currently = track["@attr"] && track["@attr"].nowplaying == "true";

    nowPlayingNode.appendChild(getMetadata(track, currently));

    // const metadata = create('div', {
    //   class: 'np-metadata',
    //   innerHTML: getMetadata(track, currently),
    // }, nowPlayingNode);

    setTimeout(() => {
      nowPlayingNode.setAttribute("class", "now-playing loaded");
    }, 100);
  }

  getNowPlaying();
};

lastfm();
</code></pre></article></main><div class="article-rhs-container"><div class="article-rhs"><span><div class="git-history-table-container"><span class="git-history-table-title">Revisions</span><table class="git-history-table"><tr><th>Date</th><th>Hash</th></tr><tbody><tr><td class="commit-date-tr">2023-06-02</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/509802b76647b08ac4a2c2db5db9cdd9bd7a8344//lastfm.js">509802b</a></td></tr><tr><td class="commit-date-tr">2023-05-31</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/851f22c273e6a4eda4361b6436c334302b8827f5//lastfm.js">851f22c</a></td></tr><tr><td class="commit-date-tr">2023-05-31</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/9c86f9d1e4ae7f3537d3a346c7a3173ef70581b8//lastfm.js">9c86f9d</a></td></tr><tr><td class="commit-date-tr">2023-05-31</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/a6d238a2ed11e6ae250518a360a2b5a04cd99ee7//lastfm.js">a6d238a</a></td></tr><tr><td class="commit-date-tr">2023-05-31</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/1691056cfc35258079998c3782e121b16f634f53//lastfm.js">1691056</a></td></tr><tr><td class="commit-date-tr">2023-05-20</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/8b846987a7062f870734a2ba7ca141bd364f4d81//lastfm.js">8b84698</a></td></tr><tr><td class="commit-date-tr">2023-04-29</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/ff07dc74f4865a7304fccbcc8bbfcd6f5b8b09bd//lastfm.js">ff07dc7</a></td></tr><tr><td class="commit-date-tr">2023-04-29</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/3e568fa0ab2525356f833455a8c9879c4ba55613//lastfm.js">3e568fa</a></td></tr><tr><td class="commit-date-tr">2023-04-29</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/4f5fec4d2e54b1e254155a74ce88f6938c48139d//lastfm.js">4f5fec4</a></td></tr><tr><td class="commit-date-tr">2023-04-27</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/7d7424036b1447206d9015bf773d2a1d8cb05fb3//lastfm.js">7d74240</a></td></tr><tr><td class="commit-date-tr">2023-04-24</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/bb7f08ce76f798f98da87e164e29fd681717e702//lastfm.js">bb7f08c</a></td></tr><tr><td class="commit-date-tr">2023-04-23</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/cb1c352b10a2b8705fd48280c4d02ce906ed1fe8//lastfm.js">cb1c352</a></td></tr></tbody></table></div></span><span><div class="prev-next-up-buttons-container">Navigation<table class="prev-next-up-buttons"><tr><td>Next</td><td><a class="next-button" href="/components/lastfm/lastfm.clj.html">lastfm</a></td></tr><tr><td>Up</td><td><a class="up-button" href="/components/lastfm">lastfm</a></td></tr></table></div></span></div></div></div></body></html>