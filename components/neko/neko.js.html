<!DOCTYPE html><html><head><meta charset="UTF-8" /><title>neko / neko / components / Jake Chvatal</title><meta content="width=device-width,initial-scale=1.0" name="viewport" /><meta content="neko" property="og:title" /><meta content="website" property="og:type" /><meta content="https://jake.isnt.online" property="og:url" /><meta content="Jake Chvatal" property="og:site_name" /><meta content="hi" name="description" /><meta content="Operating Systems, webring, programming, languages" name="keywords" /><meta content="Jake Chvatal" name="author" /><meta content="index,follow" name="robots" /><meta content="white" media="(prefers-color-scheme: light)" name="theme-color" /><meta content="#111" media="(prefers-color-scheme: dark)" name="theme-color" /><link href="/favicon/apple-touch-icon.png" rel="apple-touch-icon" /><link href="/manifest.json" rel="manifest" /><link href="/resources/style.css" id="/resources/style.css" rel="stylesheet" type="text/css" /><link href="/resources/global.css" id="/resources/global.css" rel="stylesheet" type="text/css" /><script id="/resources/lib.js" src="/resources/lib.js"></script><link href="/resources/elements.css" id="/resources/elements.css" rel="stylesheet" type="text/css" /><script defer="defer" id="/resources/elements.js" src="/resources/elements.js"></script><script defer="defer" id="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/highlight.min.js" src="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/highlight.min.js"></script><script defer="defer" id="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/languages/clojure.min.js" src="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/languages/clojure.min.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/nord.min.css" id="dark-theme-highlight" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-light.min.css" id="light-theme-highlight" rel="stylesheet" /></head><body><span><div class="sidebar"><div class="url-path"><a href="/">jake.</a><a href="https://isnt.online"> ~ </a><span> / </span><a href="./index.html">components</a><span> / </span><a href="./index.html">neko</a><span> / </span><b>neko</b></div><span><div class="toggle-dark-mode-container"><button class="toggle-dark-mode"></button></div><script defer="defer" id="/components/toggle-dark-mode/toggle-dark-mode.js" src="/components/toggle-dark-mode/toggle-dark-mode.js"></script><link href="/components/toggle-dark-mode/toggle-dark-mode.css" id="/components/toggle-dark-mode/toggle-dark-mode.css" rel="stylesheet" type="text/css" /></span></div><link href="/components/sidebar/sidebar.css" id="/components/sidebar/sidebar.css" rel="stylesheet" type="text/css" /></span><div class="site-body"><main><article class="wikipage"><h1 class="title-top">neko</h1><pre><code class="language-js has-raw-code /components/neko/neko.js">// TODO:
// Go to a specific place to sleep
// Sit next to the left or right of the cursor, whichever is closer
// Sit next to/on/around links if they are hovered

const neko = () => {
  function createNekoImage() {
    return create('img', {
      src: currentAnimation[0],
      width: '32px',
      height: '32px',
      alt: '🐱',
      id: 'neko'
    });
  }

  function timestamp() {
    return new Date().getTime();
  }

  const neko = document.querySelector('.neko');
  const nekoBed = document.querySelector('.neko-bed');

  const nekoUrl = "/components/neko/assets/";

  const Neko = {
    yawn: [nekoUrl + "yawn1.png", nekoUrl + "yawn2.png"],
    wash: [nekoUrl + "wash1.png", nekoUrl + "wash2.png"],
    awake: [nekoUrl + "awake.png", nekoUrl + "awake.png"],
    sleep: [nekoUrl + "sleep1.png", nekoUrl + "sleep2.png"],
    scratch: [nekoUrl + "scratch1.png", nekoUrl + "scratch2.png"],

    up: [nekoUrl + "up1.png", nekoUrl + "up2.png"],
    down: [nekoUrl + "down1.png", nekoUrl + "down2.png"],
    left: [nekoUrl + "left1.png", nekoUrl + "left2.png"],
    right: [nekoUrl + "right1.png", nekoUrl + "right2.png"],
    upLeft: [nekoUrl + "upleft1.png", nekoUrl + "upleft2.png"],
    upRight: [nekoUrl + "upright1.png", nekoUrl + "upright2.png"],
    downLeft: [nekoUrl + "downleft1.png", nekoUrl + "downleft2.png"],
    downRight: [nekoUrl + "downright1.png", nekoUrl + "downright2.png"],
  }

  const idleLevelKeys = [
    "awake",
    "awake",
    "awake",
    "awake",
    "awake",
    "yawn",
    "awake",
    "scratch",
    "wash",
    "awake",
    "yawn",
    "sleep",
  ]

  const Direction = {
    left: "left",
    right: "right",
    up: "up",
    down: "down",
    downLeft: "downLeft",
    downRight: "downRight",
    upLeft: "upLeft",
    upRight: "upRight",
    still: "awake",
  };

  const mouseTolerance = 5;
  const nekoStepLength = 16;
  const animationSpeed = 200;

  let currentX;
  let currentY;
  let mouseX;
  let mouseY;

  const distanceFromCursorX = -30;
  const distanceFromCursorY = 10;

  let currentAnimation = Neko.sleep;

  const nekoImage = createNekoImage();

  document.addEventListener('mousemove', function(e) {
    mouseX = e.clientX;
    mouseY = e.clientY;

    lastMouseMoved = timestamp();
  });

  function animate(first=true) {
    if (currentAnimation) {
      nekoImage.setAttribute("src", currentAnimation[first ? 0 : 1]);
    }

    setTimeout(() => animate(!first), animationSpeed);
  }

  function setAnimation(anim) {
    // console.log("Neko: ", anim);
    currentAnimation = Neko[anim];
  }

  function determineDirection(x, y) {
    if (x === 0 && y === 0) {
      return Direction.still;
    }

    if (x === 0) {
      return y > 0 ? Direction.down : Direction.up;
    }

    if (y === 0) {
      return x > 0 ? Direction.right : Direction.left;
    }

    if (x > 0 && y > 0) {
      return Direction.downRight;
    }

    if (x > 0 && y < 0) {
      return Direction.upRight;
    }

    if (x < 0 && y > 0) {
      return Direction.downLeft;
    }

    if (x < 0 && y < 0) {
      return Direction.upLeft;
    }
  }

  function moveInX() {
    if ((mouseX - currentX - distanceFromCursorX) > nekoStepLength) {
      return nekoStepLength;
    } else if ((mouseX - currentX - distanceFromCursorX) < nekoStepLength * -1) {
      return -nekoStepLength;
    } else {
      return 0;
    }
  }

  function moveInY() {
    if ((mouseY - currentY - distanceFromCursorY) > nekoStepLength) {
      return nekoStepLength;
    } else if ((mouseY - currentY - distanceFromCursorY) < nekoStepLength * -1) {
      return -nekoStepLength;
    } else {
      return 0;
    }
  }

  function moveNeko(x, y) {
    currentX += x;
    currentY += y;
    neko.style.left = currentX + 'px';
    neko.style.top = currentY + 'px';
  }

  let idleLevel = 0;
  let nekoAwake = false;

  function nekoEventLoop() {
    const x = moveInX();
    const y = moveInY();
    if (nekoAwake && (x !== 0 || y !== 0)) { // if we can move, we're moving!
      // console.log("moving", x, y);
      idleLevel = 0;
      moveNeko(x, y);
      setAnimation(determineDirection(x, y));
    } else { // if we can't move, we're idle
      // console.log("idle", idleLevel);
      if (idleLevel < idleLevelKeys.length - 1) {
        idleLevel++;
        setAnimation(idleLevelKeys[idleLevel]);
      }
    }

    setTimeout(nekoEventLoop, animationSpeed);
  }


  neko.addEventListener('click', function(e) {
    if (!nekoAwake) {
      currentX = e.clientX - 32;
      currentY = e.clientY - 32;
    }

    nekoAwake = true;
    idleLevel = 0;
    setAnimation("awake");
    nekoEventLoop();
  });

  neko.appendChild(nekoImage);
  animate();
};

runOnDesktop(neko);
</code></pre></article></main><div class="article-rhs-container"><div class="article-rhs"><span><div class="git-history-table-container"><span class="git-history-table-title">Revisions</span><table class="git-history-table"><tr><th>Date</th><th>Hash</th></tr><tbody><tr><td class="commit-date-tr">2023-06-02</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/509802b76647b08ac4a2c2db5db9cdd9bd7a8344//neko.js">509802b</a></td></tr><tr><td class="commit-date-tr">2023-05-31</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/9c86f9d1e4ae7f3537d3a346c7a3173ef70581b8//neko.js">9c86f9d</a></td></tr><tr><td class="commit-date-tr">2023-04-29</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/75d93cdd80cde8cc5129ded8e20b6b1cfce2f8a2//neko.js">75d93cd</a></td></tr><tr><td class="commit-date-tr">2023-04-29</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/cdca967a6f5a0df39af08c9593a7b418a02116b8//neko.js">cdca967</a></td></tr><tr><td class="commit-date-tr">2023-04-27</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/7d7424036b1447206d9015bf773d2a1d8cb05fb3//neko.js">7d74240</a></td></tr><tr><td class="commit-date-tr">2023-04-24</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/bb7f08ce76f798f98da87e164e29fd681717e702//neko.js">bb7f08c</a></td></tr><tr><td class="commit-date-tr">2023-04-23</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/6ee4991eeb8aa56eb7cb48eff96317fc8bca4cc7//neko.js">6ee4991</a></td></tr><tr><td class="commit-date-tr">2023-04-23</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/42adc715e00c854355138e3e81528a012671a058//neko.js">42adc71</a></td></tr><tr><td class="commit-date-tr">2023-04-23</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/594ce767530a0d88e1ab12e20082855f48df6a64//neko.js">594ce76</a></td></tr><tr><td class="commit-date-tr">2023-04-23</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/57968afc2a72136df1afaeece83e039b00258f9b//neko.js">57968af</a></td></tr><tr><td class="commit-date-tr">2023-04-23</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/092b421087505ab04dd5c06f24f9dee462c26b9a//neko.js">092b421</a></td></tr><tr><td class="commit-date-tr">2023-04-23</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/c0ed1b6bbc4c23bfc22b300276785612d83d6fe4//neko.js">c0ed1b6</a></td></tr></tbody></table></div></span><span><div class="prev-next-up-buttons-container">Navigation<table class="prev-next-up-buttons"><tr><td>Previous</td><td><a class="prev-button" href="/components/neko/assets">assets</a></td></tr><tr><td>Up</td><td><a class="up-button" href="/components/neko">neko</a></td></tr></table></div></span></div></div></div></body></html>