<!DOCTYPE html><html ><head ><meta charset="utf-8"></meta><title >dev-server.ts / Jake Chvatal</title><meta property="og:title" content="dev-server.ts"></meta><meta property="og:type" content="website"></meta><meta property="og:url" content="file:///Users/jake/Documents/personal/site/docs"></meta><meta property="og:site_name" content="Jake Chvatal"></meta><meta name="keywords" content="jake"></meta><meta name="author" content="Jake Chvatal"></meta><meta name="robots" content="index,follow"></meta><meta name="description" content="hi"></meta><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"></meta><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#111"></meta><link rel="icon" type="image/x-icon" href="/Users/jake/Documents/personal/site/favicons/favicon.ico"></link><link rel="apple-touch-icon" href="/Users/jake/Documents/personal/site/favicons/apple-touch-icon.png"></link><link rel="stylesheet" type="text/css" href="/resources/style.css" id="/resources/style.css"></link><link rel="stylesheet" type="text/css" href="/resources/global.css" id="/resources/global.css"></link><script src="/resources/lib.js" id="/resources/lib.js" type="module"></script><link rel="stylesheet" type="text/css" href="/resources/elements.css" id="/resources/elements.css"></link><link rel="manifest" href="/resources/manifest.json"></link><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/nord.min.css" id="dark-theme-highlight"></link><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-light.min.css" id="light-theme-highlight"></link><script src="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/highlight.min.js" id="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/highlight.min.js" type="undefined"></script><script src="/resources/elements.js" id="/resources/elements.js" type="module" defer="true"></script></head><body ><link rel="stylesheet" href="/components/Sidebar/sidebar.css"></link><div class="sidebar"><div class="url-path"><b >jake.</b><span > / </span><a href="file:///Users/jake/Documents/personal/site/docs/resources/index.html">resources</a><span > / </span><b >dev-server.ts</b></div><script src="/components/ToggleDarkMode/toggle-dark-mode.js" type="module"></script><link rel="stylesheet" href="/components/ToggleDarkMode/toggle-dark-mode.css"></link><div class="toggle-dark-mode-container"><button class="toggle-dark-mode"></button></div></div><div class="site-body"><main ><article class="wikipage"><h1 class="title-top">dev-server.ts</h1><pre ><code class="language-ts has-raw-code">function id(id: string): HTMLElement | null {
  return document.getElementById(id);
}

function filetype(path) {
  return path.split(&quot;.&quot;).pop();
}

function reload_html(path) {
  console.log(&quot;Reloading HTML&quot;);

  const pathname = window.location.pathname;
  const pathWithIndex = window.location.pathname + &quot;index.html&quot;;
  if (pathname === path || pathWithIndex === path) {
    window.location.reload();
  }
}

function reload_js(path) {
  const v = id(path);
  if (!v) return;
  v[&quot;src&quot;] = `${path}?${Date.now()}`;
}

function add_css(path, onload) {
  const elem = document.createElement(&quot;link&quot;, onload);
  elem.rel = &quot;stylesheet&quot;;
  elem.type = &quot;text/css&quot;;
  elem.href = path;
  elem.id = path;
  elem.onload = onload;
  document.body.appendChild(elem);
}

const last_ids = {};

function reload_css(path) {
  let path_hashed = `${path}?${Date.now()}`;
  add_css(path_hashed, () =&gt; {
    // TODO: This is supposed to avoid style flicker by adding a new stylesheet
    // i think this is a light-&gt;darkmode thing?

    const findIdPath = last_ids[path] &amp;&amp; id(last_ids[path]);
    if (findIdPath) {
      findIdPath.remove();
    } else {
      id(path)?.remove();
    }

    last_ids[path] = path_hashed;
  });
}

// connect to dev server websocket
const ws = new WebSocket(&quot;ws://127.0.0.1:4242/__hmr&quot;);

ws.onopen = () =&gt; {
  console.log(&quot;Connected to dev server&quot;);
};

ws.onmessage = (msg) =&gt; {
  console.log(&quot;Received message from dev server&quot;, msg);
  if (msg.data === &quot;reload&quot;) {
    window.location.reload();
  } else {
    // assume that a path has been sent for a specific file to refresh
    switch (filetype(msg.data)) {
      case &quot;html&quot;:
        reload_html(msg.data);
        break;
      case &quot;js&quot;:
        reload_js(msg.data);
        break;
      case &quot;css&quot;:
        reload_css(msg.data);
        break;
      default:
        console.log(&quot;Unknown file type&quot;, msg.data);
    }
  }
};

ws.onerror = (err) =&gt; {
  console.error(&quot;Error connecting to dev server&quot;, err);
};

ws.onclose = () =&gt; {
  console.log(&quot;Connection closed to the dev server&quot;);
};
</code></pre></article></main><div class="article-rhs-container"><div class="article-rhs"><div class="git-history-table-container"><span class="git-history-table-title">Revisions</span><table class="git-history-table"><thead ><tr ><th >Date</th><th >Hash</th></tr></thead><tbody ><tr ><td class="commit-date-tr">2024-04-13</td><td class="commit-link-tr">0c9b2c0e</td></tr><tr ><td class="commit-date-tr">2024-04-01</td><td class="commit-link-tr">b8deb4ae</td></tr><tr ><td class="commit-date-tr">2024-03-31</td><td class="commit-link-tr">02dca1b8</td></tr><tr ><td class="commit-date-tr">2024-03-31</td><td class="commit-link-tr">dec57c39</td></tr><tr ><td class="commit-date-tr">2024-03-31</td><td class="commit-link-tr">9a544393</td></tr></tbody></table></div><div class="prev-next-up-buttons-container">Navigation<table class="prev-next-up-buttons"><tr ><td >Previous</td><td ><a class="prev-button" href="file:///Users/jake/Documents/personal/site/docs/resources/lib.ts.html">lib.ts</a></td></tr><tr ><td >Next</td><td ><a class="next-button" href="file:///Users/jake/Documents/personal/site/docs/resources/fonts.html">fonts</a></td></tr><tr ><td >Up</td><td ><a class="up-button" href="file:///Users/jake/Documents/personal/site/docs/resources.html">resources</a></td></tr></table></div></div></div></div></body></html>