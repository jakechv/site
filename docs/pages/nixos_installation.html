<!DOCTYPE html><html><head><meta charset="UTF-8" /><title>nixos_installation | Jake Chvatal</title><meta content="width=device-width,initial-scale=1.0" name="viewport" /><meta content="nixos_installation" property="og:title" /><meta content="website" property="og:type" /><meta content="https://jake.isnt.online" property="og:url" /><meta content="Jake Chvatal" property="og:site_name" /><meta content="hi" name="description" /><meta content="Operating Systems, webring, programming, languages" name="keywords" /><meta content="Jake Chvatal" name="author" /><meta content="index,follow" name="robots" /><meta content="#fff" name="theme-color" /><link href="/style.css" rel="stylesheet" /><script src="/lib.js"></script></head><body><div class="site-body"><div class="sidebar"><a href="/">jake.</a><a href="https://isnt.online"> ~ </a><span> / </span><a href="./index.html">pages</a><span> / </span><b>nixos_installation</b></div><main><article class="wikipage"><h1 class="title-top">nixos_installation</h1><div><p>I've long been tired of the dependency management of Linux and wanted totry a new system: <a href="https://nixos.org">NixOS</a>. It's an operating systemcentered around system configuration – a DevOps tool and a way to manageconfiguration files as well as a proper Linux-based operating system.</p><p>I did have a bit of trouble installing it so I wanted to catalogue theprocess here.</p><p>To help with the installation, I referenced <a href="https://gist.github.com/domenkozar/b3c945035af53fa816e0ac460f1df853">Domen Kozar'sinstructions</a>,<a href="https://github.com/jethrokuan/nix-config">Jethro's configuration</a> and<a href="https://github.com/kylesferrazza/nix/">Kyle's configuration</a>. I alsomade substantial use of the <a href="https://nixos.org/nixos/manual">NixOSmanual</a> and its instructions. I'll besummarizing steps taken by each of these articles; refer to the NixOSmanual or the instructions if you'd like more information about theabbreviated steps.</p><p>As the title says, I installed <code>NixOS 20.03</code> on the Dell XPS 9370 i7UHD. I can't guarantee that these instructions will work for yoursystem. My current configuration, including some of the code mentionedin this article, can be found<a href="https://github.com/jakechv/nix-cfg">here</a>.</p><p>Make sure that you have a flash drive handy with a capacity greater than2 gigabytes. My first go used installation media that didn't have theentire ISO written to it and I had issues booting.</p><h1 id="setup">Setup</h1><h2 id="recovery-disk">Recovery Disk</h2><p>First remember to create a recovery disk for Windows. I didn't do this,but it's probably a good idea! (I'm still looking for my Windowspartition…)</p><h2 id="reboot-to-the-bios">Reboot to the BIOS</h2><p>Press F2 repeatedly when the Dell logo appears on boot (don't hold it,as this may be interpreted as a stuck key) and reboot into the BIOSsettings.</p><h2 id="bios-settings">BIOS Settings</h2><p>Disable secure boot and RAID mode. It's unclear why RAID mode is on bydefault, but this isn't somethign that should be used by the XPS.</p><h2 id="make-an-installation-disk">Make an Installation Disk</h2><p>Download an ISO from <a href="https://nixos.org/download.html">the website</a>. Iwouldn't recommend the graphical installation CD, as it'll takesubstantially longer to boot and at the time of this writing offers noreal advantage over the minimal installation disk. You'll be using toolswith command-line interfaces anyways.</p><h2 id="install-iso">Install ISO</h2><p>For Linux, I recommend using <code>dd</code> to write the media to your USB. ForWindows 10, I'd recommend using <a href="https://rufus.ie">Rufus</a>.</p><p>I used Rufus and had trouble with the installation media when writingthe ISO, but using DD mode worked well. I'd recommend using that tostart.</p><h1 id="provisioning-the-installation">Provisioning the Installation</h1><h2 id="booting-the-installation-media">Booting the Installation Media</h2><p>Plug the flash drive into any port on your laptop and reboot.</p><p>On boot, press F10 repeatedly to enter the boot selection mode. Use theup and down arrow keys to navigate to the name of your flash driveloaded with the installation media. Press enter when the proper media ishighlighted.</p><h2 id="initial-system-configuration">Initial System Configuration</h2><p>The computer should now be booted to the NixOS installer. It'll show youseveral images to chose from.</p><p>Select <code>NixOS Live CD</code> if you're ready to install. The other optionsprovided may be used if you'd like to try out the operating systemwithout a full installation.</p><h3 id="troubleshooting">Troubleshooting</h3><p>If the media didn't boot properly and you do not now see a terminalshowing that you've booted into NixOS, make sure that you've chosen thecorrect installation image for your system. If you provisioned yourinstallation media as an ISO, try using DD mode.</p><h2 id="connecting-to-the-internet">Connecting to The Internet</h2><p>Now that you've successfully booted the system, it's time to connect tothe internet. Ethernet would be easy but we still have some networkingtools.</p><p>We'll want to do everything as root for the installation, so:</p><pre><code class="language-bash">sudo -i</code></pre><p>To connect to the internet, run</p><pre><code class="language-bash">wpa_supplicant -i {WiFi card} <(wpa_passphrase "{SSID}" "{password}")</code></pre><p>where {WiFi card} is the name found with <code>ifconfig</code> beginning with <code>wlp</code>or <code>wlan</code> (typically <code>wlan0</code> or <code>wlp2s0</code>), {SSID} is the name of yourWiFi network and {password} is the password for the network. Make surethat the latter two are both strings.</p><p>To confirm your connection, use <code>ping google.com</code> or<code>ping {stable site of choice}</code>. If you receive frequent responses at theterminal, you have a connection.</p><h2 id="partitioning-the-drive">Partitioning the Drive</h2><p>I'll yield to the Arch Wiki here; they'll maintain documentation moreaccurate and thorough than what I can cover here. Here's the gist of it:</p><ul><li><p>Create three partitions:</p><ul><li>a boot partition {\~100 mb},</li><li>a main partition {rest of disk, -1/2 ram size},</li><li>and a swap partition {1/2 ram capacity}.</li></ul></li><li><p>Format each with the file system of your choice.</p><ul><li>The boot partition should be FAT.</li><li>The main partition should be a file system of your choice. Use ext4if you want something simple and reliable; use btrfs or zfs if youwant something advanced.</li><li>The swap partition should be formatted as a swap partition.</li></ul></li></ul><h2 id="mounting-and-installing">Mounting and Installing</h2><p>This system's a UEFI system, so we'll have to mount two partitions.Mount your main partition to <code>/mnt</code>:</p><pre><code class="language-bash">mount nixos /mnt</code></pre><p>Mount your boot partition to <code>/mnt/boot</code>:</p><pre><code class="language-bash">mkdir -p /mnt/boot
mount boot /mnt/boot</code></pre><p>This assumes that you've named your main and boot partitions 'nixos' and'boot' respectively.</p><h1 id="initial-configuration">Initial Configuration</h1><p>Now that everything is mounted, you'll want to generate an initialconfiguration for your system.</p><p>This can be accomplished with</p><pre><code class="language-bash">nixos-generate-config -d</code></pre><h2 id="editing-the-configuration">Editing the Configuration</h2><p>You should now have two files visible in the <code>/etc/nixos</code> directory:</p><ul><li>configuration.nix</li><li>hardware-configuration.nix</li></ul><p>Make sure that hardware-configuration.nix contains three partitions –one for each partition you created earlier – with the same file systemsand configurations. If not, update the files with the correct values.</p><h2 id="initial-configuration">Initial Configuration</h2><p>You'll now need to edit properly configure <code>configuration.nix</code>. Most ofthe defaults are fine, but you'll want to install a sane editor to makeit immediately usable. I'd suggest <code>vim</code> or <code>nvim</code>. You'll probably alsowant <code>git</code> and <code>wget</code> for saving your configuration or cloning that ofanother.</p><p>Add these to <code>environment.systemPackages</code>:</p><pre><code class="language-nix">environment.systemPackages = [
  nvim wget git
];</code></pre><p>You might also want a better program for configuring networking. Ifyou're accustomed to Network Manager, add</p><pre><code class="language-nix">~services.networkmanager.enable = true;</code></pre><p>to the configuration.</p><p>You should probably add a user as well. There's a template for userconfiguration in the file, but try amending it:</p><pre><code class="language-nix">users.users.{username} = {
  isNormalUser = true;
  home = "/home/{username}";
  extraGroups = [ "wheel" "networkmanager" ];
};</code></pre><p>You'll want to add yourself to the <code>"networkmanager"</code> group if you'reusing Network Manager in lieu of wpa<sub>supplicant</sub>. 'Wheel' willallow this user to use <code>sudo</code>.</p><h1 id="first-boot">First Boot</h1><p>You're ready to install and boot the system! Run:</p><pre><code class="language-bash">nixos-install</code></pre><p>Make sure to set the password for the root user to something youremember when prompted.</p><h2 id="final-touches">Final Touches</h2><p>Reboot first: <code>reboot</code>. Now, log in as the root user when prompted forlogin and password.</p><p>Set an initial password for the user you created:</p><pre><code class="language-bash">passwd {username}</code></pre><p>and provide the password when prompted.</p><p>You're now ready to go!</p></div></article></main><div class="git-hist-table"><table><tbody><tr><td>2023-02-22</td><td><a href="https://github.com/jakeisnt/wiki/blob/ea5044fc387f17e24dcab6f3873a541cd640bfa1//home/jake/wiki/pages/nixos_installation.md">ea5044fc</a></td></tr></tbody></table></div></div></body></html>