<!DOCTYPE html><html ><head ><meta charset="utf-8"></meta><title >main.ts / Jake Chvatal</title><meta property="og:title" content="main.ts"></meta><meta property="og:type" content="website"></meta><meta property="og:url" content="https://jake.isnt.online"></meta><meta property="og:site_name" content="Jake Chvatal"></meta><meta name="keywords" content="jake"></meta><meta name="author" content="Jake Chvatal"></meta><meta name="robots" content="index,follow"></meta><meta name="description" content="hi"></meta><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"></meta><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#111"></meta><link rel="icon" type="image/x-icon" href="/Users/jake/Documents/personal/site/favicons/favicon.ico"></link><link rel="apple-touch-icon" href="/Users/jake/Documents/personal/site/favicons/apple-touch-icon.png"></link><link rel="stylesheet" type="text/css" href="/resources/style.css" id="/resources/style.css"></link><link rel="stylesheet" type="text/css" href="/resources/global.css" id="/resources/global.css"></link><script src="/resources/lib.js" id="/resources/lib.js" type="module"></script><link rel="stylesheet" type="text/css" href="/resources/elements.css" id="/resources/elements.css"></link><link rel="manifest" href="/resources/manifest.json"></link><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/nord.min.css" id="dark-theme-highlight"></link><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-light.min.css" id="light-theme-highlight"></link><script src="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/highlight.min.js" id="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/highlight.min.js" type="undefined"></script><script src="/resources/elements.js" id="/resources/elements.js" type="module" defer="true"></script></head><body ><link rel="stylesheet" href="/components/Sidebar/sidebar.css"></link><div class="sidebar"><div class="url-path"><b >jake.</b><span > / </span><a href="https://jake.isnt.online/src/index.html">src</a><span > / </span><b >main.ts</b></div><script src="/components/ToggleDarkMode/toggle-dark-mode.js" type="module"></script><link rel="stylesheet" href="/components/ToggleDarkMode/toggle-dark-mode.css"></link><div class="toggle-dark-mode-container"><button class="toggle-dark-mode"></button></div></div><div class="site-body"><main ><article class="wikipage"><h1 class="title-top">main.ts</h1><pre ><code class="language-ts has-raw-code">// entrypoint of the program; this is the cli

import { deploy } from &quot;./deploy&quot;;
import { sourceDir } from &quot;./constants&quot;;
import { cli } from &quot;utils/cli&quot;;
import { buildFromPath } from &quot;./build.js&quot;;
import { singleFileServer, directoryServer } from &quot;./server&quot;;
import { Path } from &quot;utils/path&quot;;
import {
  sourceDir as SITE_DIRECTORY,
  siteName,
  deploymentBranch,
  localPort,
} from &quot;./constants&quot;;

const localhostUrl = `http://localhost`;
const wsLocalhostUrl = `ws://localhost`;
const devWebsocketPath = &quot;/__devsocket&quot;;

// paths to ignore by default from the website we build
const commonIgnorePaths = [&quot;.git&quot;, &quot;node_modules&quot;];

/**
 * Build a website from the incoming paths.
 *
 * Usage: site build ./ ./docs ./ http://localhost:3000
 */
const build = (incomingPaths?: string[]) =&gt; {
  const paths = incomingPaths?.length ? incomingPaths : [&quot;.&quot;];

  if (!paths[0]) {
    throw new Error(`No source directory provided. Exiting!`);
  }

  const sourceDir = Path.create(paths[0]);

  const targetDir = paths[1]
    ? Path.create(paths[1])
    : Path.create(sourceDir.toString() + &quot;/docs&quot;);

  const fallbackSourceDir = paths[2]
    ? Path.create(paths[2])
    : Path.create(SITE_DIRECTORY);

  const rootUrl = paths[3] ?? &quot;file://&quot; + targetDir.toString();

  const resourcesDir = Path.create(sourceDir.toString() + &quot;/resources&quot;);
  const faviconsDir = Path.create(sourceDir.toString() + &quot;/favicons&quot;);

  buildFromPath({
    siteName,
    rootUrl,
    sourceDir: sourceDir.toString(),
    fallbackSourceDir: fallbackSourceDir.toString(),
    targetDir: targetDir.toString(),
    // &#x27;ignorePaths&#x27; are expected to be absolute
    ignorePaths: commonIgnorePaths.map((p) =&gt; sourceDir.toString() + &quot;/&quot; + p),
    resourcesDir: resourcesDir.toString(),
    faviconsDir: faviconsDir.toString(),
  });
};

/**
 * Deploy the current website.
 */
const deployWebsite = () =&gt; {
  const currentRepo = Path.create(&quot;.&quot;).repo;

  if (!currentRepo) {
    console.log(
      &quot;Current path does not have a git repository. Unable to deploy.&quot;
    );
    return;
  }

  deploy({
    currentRepo,
    deploymentBranch,
    targetDir: Path.create(&quot;./docs&quot;).toString(),
  });
};

/**
 * Serve whatever is on the path provided.
 * @param {*} incomingPaths a list of paths to serve from.
 */
const serve = (incomingPaths?: string[]) =&gt; {
  const paths = incomingPaths?.length ? incomingPaths : [&quot;.&quot;];

  const path = Path.create(paths[0]);

  // if we were provided a dir, that directory
  // becomes the root of a tree we serve
  if (path.isDirectory({ noFSOperation: true })) {
    directoryServer({
      absolutePathToDirectory: path,
      fallbackDirPath: sourceDir,
      url: localhostUrl,
      port: localPort,
      siteName: &quot;Jake Chvatal&quot;,
      devWebsocketUrl: devWebsocketPath,
    });
  }

  // otherwise, we serve just the file that was pointed to from all paths
  // this is mostly useless because html files can&#x27;t pull in resources, for ex.,
  // but it&#x27;s good for testing the parsing and interpretation of new file types.
  else {
    singleFileServer({
      url: localhostUrl,
      localPort,
      absolutePathToFile: path.toString(),
      siteName: &quot;Jake Chvatal&quot;,
      devWebsocketPath,
      wsLocalhostUrl,
    });
  }
};

const app = cli(&quot;site&quot;)
  .describe(&quot;compiles the website&quot;)
  .option(&quot;deploy&quot;)
  .describe(&quot;deploy the website&quot;)
  .action(deployWebsite)
  .option(&quot;build&quot;)
  .describe(&quot;build the website&quot;)
  .action(build)
  .option(&quot;serve&quot;)
  .describe(&quot;serve the website&quot;)
  .action(serve);

function main() {
  const args = process.argv.slice(2);
  app.exec(args);
}

main();
</code></pre></article></main><div class="article-rhs-container"><div class="article-rhs"><div class="git-history-table-container"><span class="git-history-table-title">Revisions</span><table class="git-history-table"><thead ><tr ><th >Date</th><th >Hash</th></tr></thead><tbody ><tr ><td class="commit-date-tr">2024-04-13</td><td class="commit-link-tr">0c9b2c0e</td></tr><tr ><td class="commit-date-tr">2024-04-13</td><td class="commit-link-tr">c1bd8543</td></tr><tr ><td class="commit-date-tr">2024-04-13</td><td class="commit-link-tr">f9cafd2d</td></tr><tr ><td class="commit-date-tr">2024-04-01</td><td class="commit-link-tr">a3c37e13</td></tr><tr ><td class="commit-date-tr">2024-04-01</td><td class="commit-link-tr">3baa0660</td></tr><tr ><td class="commit-date-tr">2024-04-01</td><td class="commit-link-tr">645f49d5</td></tr><tr ><td class="commit-date-tr">2024-04-01</td><td class="commit-link-tr">110e0165</td></tr><tr ><td class="commit-date-tr">2024-03-31</td><td class="commit-link-tr">02dca1b8</td></tr><tr ><td class="commit-date-tr">2024-03-31</td><td class="commit-link-tr">95fa0ee8</td></tr><tr ><td class="commit-date-tr">2024-03-31</td><td class="commit-link-tr">3e22c4b6</td></tr><tr ><td class="commit-date-tr">2024-03-31</td><td class="commit-link-tr">dec57c39</td></tr><tr ><td class="commit-date-tr">2024-03-31</td><td class="commit-link-tr">dc4d8458</td></tr><tr ><td class="commit-date-tr">2024-03-31</td><td class="commit-link-tr">57bb7bd8</td></tr><tr ><td class="commit-date-tr">2024-03-31</td><td class="commit-link-tr">9a544393</td></tr></tbody></table></div><div class="prev-next-up-buttons-container">Navigation<table class="prev-next-up-buttons"><tr ><td >Next</td><td ><a class="next-button" href="https://jake.isnt.online/src/file.html">file</a></td></tr><tr ><td >Up</td><td ><a class="up-button" href="https://jake.isnt.online/src.html">src</a></td></tr></table></div></div></div></div></body></html>