<!DOCTYPE html><html><head><meta charset="UTF-8" /><title>git / src / Jake Chvatal</title><meta content="width=device-width,initial-scale=1.0" name="viewport" /><meta content="git" property="og:title" /><meta content="website" property="og:type" /><meta content="https://jake.isnt.online" property="og:url" /><meta content="Jake Chvatal" property="og:site_name" /><meta content="hi" name="description" /><meta content="Operating Systems, webring, programming, languages" name="keywords" /><meta content="Jake Chvatal" name="author" /><meta content="index,follow" name="robots" /><meta content="white" media="(prefers-color-scheme: light)" name="theme-color" /><meta content="#111" media="(prefers-color-scheme: dark)" name="theme-color" /><link href="/favicon/apple-touch-icon.png" rel="apple-touch-icon" /><link href="/manifest.json" rel="manifest" /><link href="/resources/style.css" id="/resources/style.css" rel="stylesheet" type="text/css" /><link href="/resources/global.css" id="/resources/global.css" rel="stylesheet" type="text/css" /><script id="/resources/lib.js" src="/resources/lib.js"></script><link href="/resources/elements.css" id="/resources/elements.css" rel="stylesheet" type="text/css" /><script defer="defer" id="/resources/elements.js" src="/resources/elements.js"></script><script defer="defer" id="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/highlight.min.js" src="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/highlight.min.js"></script><script defer="defer" id="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/languages/clojure.min.js" src="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/languages/clojure.min.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/nord.min.css" id="dark-theme-highlight" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-light.min.css" id="light-theme-highlight" rel="stylesheet" /></head><body><span><div class="sidebar"><div class="url-path"><a href="/">jake.</a><a href="https://isnt.online"> ~ </a><span> / </span><a href="./index.html">src</a><span> / </span><b>git</b></div><span><div class="toggle-dark-mode-container"><button class="toggle-dark-mode"></button></div><script defer="defer" id="/components/toggle-dark-mode/toggle-dark-mode.js" src="/components/toggle-dark-mode/toggle-dark-mode.js"></script><link href="/components/toggle-dark-mode/toggle-dark-mode.css" id="/components/toggle-dark-mode/toggle-dark-mode.css" rel="stylesheet" type="text/css" /></span></div><link href="/components/sidebar/sidebar.css" id="/components/sidebar/sidebar.css" rel="stylesheet" type="text/css" /></span><div class="site-body"><main><article class="wikipage"><h1 class="title-top">git</h1><pre><code class="language-clj">(ns git
  (:require
   const file path
   [clojure.string :as str]
   [command :as cmd]))

;; TODO: Figure out how to get git history of org-mode files as well. I don't want to lose it!
;; ASSUMES file is in relative path to wiki repo
(defn log [file source-dir]
  (let [file (str file)
        res (cmd/exec (str "git log --all --full-history --pretty=\"format:%h %H %ad\" --date default --date=format:'%Y-%m-%d' " (str file)) source-dir)]
    (if res
      (for [line (str/split res #"\R")]
        (let [[short-hash long-hash commit-date] (str/split line #" ")]
          {:short-hash short-hash
           :long-hash long-hash
           :commit-date commit-date
           :file-path file}))
      (throw (Throwable. (str "git log command failed on path " file))))))

;; ASSUMES file is in relative path to wiki repo
(defn last-log [file source-dir]
  (let [file (str file)
        res (cmd/exec (str "git log -1 --full-history --pretty=\"format:%h %H %ad %ct\" --date default --date=format:'%Y-%m-%d' " (str file)) source-dir)]
    (if res
      (let [line (first (str/split res #"\R"))
            [short-hash long-hash commit-date timestamp] (str/split line #" ")]
        {:short-hash short-hash
         :long-hash long-hash
         :commit-date commit-date
         :timestamp (Integer/parseInt timestamp)
         :file-path file})
      (throw (Throwable. (str "git log command failed on path " file))))))

(defn last-timestamp
  ([source-dir] (Integer/parseInt (cmd/exec (str  "git log -1  --pretty=format:%ct") source-dir)))
  ([source-dir path] (Integer/parseInt (cmd/exec (str  "git log -1  --pretty=format:%ct --follow -- " (str path)) source-dir))))

(defn history-link
  "Generate a link to git history"
  [long-hash file-path]
  (str const/source-url "/blob/" long-hash "/" file-path))

(defn checkout [source-dir branch]
  (cmd/exec (str "git checkout " branch) source-dir))

(defn add-all [source-dir]
  (cmd/exec (str "git add .") source-dir))

(defn commit [source-dir]
  (cmd/exec  "git -c commit.gpgsign=false commit -m \"robot commit\"" source-dir))

(defn push [source-dir]
  (cmd/exec  "git push" source-dir))

(defn remove-untracked [dir]
  (cmd/exec "git clean -fxd" dir))

(defn current-branch [dir]
  (cmd/exec "git branch --show-current" dir))

(defn status [dir]
  (println (cmd/exec "git status" dir)))

(defn stash [dir]
  (cmd/exec "git stash" dir))

(defn stash-pop [dir]
  (cmd/exec "git stash pop" dir))
</code></pre></article></main><div class="article-rhs-container"><div class="article-rhs"><span><div class="git-history-table-container"><span class="git-history-table-title">Revisions</span><table class="git-history-table"><tr><th>Date</th><th>Hash</th></tr><tbody><tr><td class="commit-date-tr">2023-06-10</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/3f32e164e7a8c80916f19bb14278a4a91372b541//git.clj">3f32e16</a></td></tr><tr><td class="commit-date-tr">2023-06-04</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/abea889946cf45c509d7cde9806dc807a27fb9dc//git.clj">abea889</a></td></tr><tr><td class="commit-date-tr">2023-06-04</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/8d71aac6a51c8a1ecf6a4782a2dc6cc05ae69e53//git.clj">8d71aac</a></td></tr><tr><td class="commit-date-tr">2023-05-27</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/690d8cae7f3a7bcbeadce2c69ee4ac0422061e98//git.clj">690d8ca</a></td></tr><tr><td class="commit-date-tr">2023-05-24</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/cccc8bf97d9a189b3f68982d0b9db764b95f6194//git.clj">cccc8bf</a></td></tr><tr><td class="commit-date-tr">2023-04-22</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/8054d43045abd43858da55b6c192ae6c88c1045b//git.clj">8054d43</a></td></tr><tr><td class="commit-date-tr">2023-04-22</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/c6a4292bd4e3c94353933e78ab392d40f88a47e4//git.clj">c6a4292</a></td></tr><tr><td class="commit-date-tr">2023-04-22</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/8dbd0b6e26596d97d427ec7c410e46c2a27c5489//git.clj">8dbd0b6</a></td></tr><tr><td class="commit-date-tr">2023-04-22</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/2ccc174cd0a5fcae9bd9fe5f533162da181c780c//git.clj">2ccc174</a></td></tr><tr><td class="commit-date-tr">2023-04-22</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/20bdb6ee0c9dcba0f11c2d83535957db0e4a60c3//git.clj">20bdb6e</a></td></tr><tr><td class="commit-date-tr">2023-04-22</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/577a00358f48f396d40beccaedd1f3b1d8416130//git.clj">577a003</a></td></tr><tr><td class="commit-date-tr">2023-04-22</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/1aee19b32fc00a9c0d461877e1a86a84b52d204c//git.clj">1aee19b</a></td></tr><tr><td class="commit-date-tr">2023-04-22</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/8646cfa4ff84684baf00aeb47b9f0e8d70ab9c60//git.clj">8646cfa</a></td></tr><tr><td class="commit-date-tr">2023-04-22</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/ca99bfd4492e3f461f63799afa70e2bd10f8f7c7//git.clj">ca99bfd</a></td></tr><tr><td class="commit-date-tr">2023-04-22</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/ec514d19cb268ef427a28cb7e4d2d77a96f76d82//git.clj">ec514d1</a></td></tr><tr><td class="commit-date-tr">2023-04-22</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/c199a9dbf7f1341ab99f6736422acdec89012a6c//git.clj">c199a9d</a></td></tr><tr><td class="commit-date-tr">2023-04-22</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/8bc62804e314fad50861d973af2ac4deb3a9c8dd//git.clj">8bc6280</a></td></tr><tr><td class="commit-date-tr">2023-02-24</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/decf6561d01bd91baa4b0ff534029922b0d20310//git.clj">decf656</a></td></tr><tr><td class="commit-date-tr">2023-02-24</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/686f88d372e8baf45169325140c04184341696a5//git.clj">686f88d</a></td></tr><tr><td class="commit-date-tr">2023-02-23</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/e79ce78dcb87083f8cc931fef9bbd85757d75893//git.clj">e79ce78</a></td></tr><tr><td class="commit-date-tr">2023-02-23</td><td class="commit-link-tr"><a href="https://github.com/jakeisnt/wiki/blob/f2dd1b2aa5813d434a28894fded612b5bb8b80a4//git.clj">f2dd1b2</a></td></tr></tbody></table></div></span><span><div class="prev-next-up-buttons-container">Navigation<table class="prev-next-up-buttons"><tr><td>Previous</td><td><a class="prev-button" href="/src/filetype">filetype</a></td></tr><tr><td>Up</td><td><a class="up-button" href="/src">src</a></td></tr></table></div></span></div></div></div></body></html>